function New-ExactRandomTextFile {
    param (
        [string]$Path,
        [long]$SizeBytes
    )

    $rng = [System.Security.Cryptography.RandomNumberGenerator]::Create()
    $fs  = [IO.File]::OpenWrite($Path)

    try {
        $written = 0

        while ($written -lt $SizeBytes) {
            $bytes = New-Object byte[] 1024
            $rng.GetBytes($bytes)

            # Convert to printable text
            $text = [Convert]::ToBase64String($bytes)
            $out  = [Text.Encoding]::ASCII.GetBytes($text)

            $toWrite = [Math]::Min($out.Length, $SizeBytes - $written)
            $fs.Write($out, 0, $toWrite)
            $written += $toWrite
        }
    }
    finally {
        $fs.Close()
        $rng.Dispose()
    }
}

New-ExactRandomTextFile "testing_5mb.txt"  5MB
New-ExactRandomTextFile "testing_10mb.txt" 10MB
New-ExactRandomTextFile "testing_1gb.txt"  1GB

Get-Item testing_*.txt | Select Name, @{N="SizeMB";E={[math]::Round($_.Length / 1MB, 2)}}
